---
title: "TEMPERATURE SHAPES MULTI-TROPHIC AQUATIC BIODIVERSITY PATTERNS ACROSS SPACE AND TIME"
author: "Cátia Lúcio Pereira and Miguel G. Matias"
date: "09 November 2025"
output:
  pdf_document: 
    fig_caption: yes
    keep_tex: yes
---

# Introduction
Freshwater ponds across Mediterranean climates experience steep spatial and temporal temperature gradients that cascade across entire food webs. To quantify how these gradients shape biodiversity, we combined environmental DNA metabarcoding with traditional morphological counts from a coordinated mesocosm experiment covering six Iberian regions and three consecutive years.

This document serves as the computational appendix for the manuscript. It loads the harmonised datasets, performs all preprocessing, and generates publication-quality figures (main text and supplements) along with high-resolution exports. Text accompanying each section highlights the ecological interpretation of the outputs to facilitate manuscript preparation.

## Analysis setup
All analyses were performed in R (v4.4+) using the tidyverse ecosystem. We suppress chunk echoes and messages for readability while keeping the full code available here. Colours, factor levels, and default model formulas are defined once to ensure consistency across figures.

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center",
  results = 'hide',
  dpi = 300
)

set.seed(20251119)

library(tidyverse)
library(magrittr)
library(ggpmisc)
library(tidyquant)
library(ggpubr)
library(knitr)
library(gridExtra)
library(directlabels)
library(viridis)
library(broom)
library(viridisLite)

```

# Methods

## Data ingestion
Community matrices (taxonomic assignments and trophic groups) and the joint diversity–environment summaries are stored in the `inputs` directory and loaded below. The CSV contains the hybridised community table, whereas the `.RData` object stores pre-computed diversity indices as well as environmental covariates aggregated at different spatial scales.
```{r}
# community data
hybrid_geo_fit_tax <- read.csv("../inputs/hybrid_geo_fit_tax_res.csv", sep = ";", header = T)

# diversity and environmental data
load("../inputs/data_metrics.RData")
```

# Set colours and group labels
```{r}
group_levels <- c("Whole-community", "Bacteria", "Phytoplankton", "Zooplankton", "Macroinvertebrates")
group_labels <- c("Whole-community", "Bacteria", "Phytoplankton", "Zooplankton", "Macroinvertebrates")
color_group <- viridisLite::viridis(option = "viridis", length(group_levels))
#names(color_group) <- group_levels

formula <- y ~ poly(x, 2)

# rename objects
global_div_env_df <- div_env_df

```

## Diversity metrics and derived quantities
To facilitate plotting across α (local), β (turnover), and γ (regional) diversity, we keep separate data frames per scale and then recombine them. β-diversity estimated via sample-based rarefaction (`beta_sn_div`) is appended to the tidy object used throughout the rest of the workflow.

# Results
The results section mirrors the structure of the main manuscript. Each subsection starts with a brief narrative that highlights the ecological interpretation of the subsequent figure, followed by the code used to generate and export the panel.

## Regional climate and accumulated diversity
We first summarise spatial patterns in thermal regimes and cumulative γ-diversity across the Iberian Pond Network. Boxplots show the distribution of annual mean temperature (TMean) and thermal variability (TSD) for each region and study year, while bar charts highlight accumulated richness per trophic group. These diagnostics provide the contextual backdrop for interpreting temperature–diversity relationships in subsequent sections.

### Global regional diversity 
```{r fig.asp=0.4, fig.height=8, fig.width=10, message=FALSE, warning=FALSE, include=FALSE}
# plot global regional diversity
global_reg_div <- global_div_env_df %>%
  filter(scale == "gamma") %>% 
  ggplot(aes(x = group, 
             y = diversity, fill = group)) + 
  facet_grid(.~site) +
  geom_bar(stat = "identity", position = "dodge", width = 0.8,
           outlier.shape = NA)  +
  scale_fill_viridis_d(
    option = "viridis",
    direction = 1,
    labels = c("W","B","P","Z","M")
  ) +
  scale_x_discrete(label = c("W", "B", "P", "Z", "M")) +
  labs(x = "Trophic group", y = expression("Global "*gamma*"-diversity"), title = "") +
  theme_tq() + 
  theme(plot.title = element_text(hjust = 0, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### Temperature variation along regions
color_years <- viridis(5, option = "G", direction = 1)

# variation of mean temp along regions
meantemp_plot <- div_env_df %>% 
  filter(scale == "gamma") %>% 
  ggplot(aes(x = year, y = est_mean_temp_12M, fill = year)) + 
  facet_grid(.~site) +
  geom_boxplot(aes(color = year), outlier.shape=NA, alpha = 0.7) +
  scale_fill_manual(values = color_years, name = "Year", labels = c("Mean", "2016", "2017", "2018")) +
  scale_color_manual(values = color_years, name = "Year", labels = c("Mean", "2016", "2017", "2018")) +
  xlab("Year") +
  ylab(bquote(Log~T[Mean]~(ºC))) +
  ggtitle("") +
  ylim(2, 3.5) +
  scale_x_discrete(label = c("Av", "16", "17", "18")) +
  # geom_jitter(aes(color = year, shape = year), position = position_jitter(width=.1, height=0)) +
  theme_tq() + 
  theme(plot.title = element_text(hjust = 0, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

# variation of sd temp along regions
sdtemp_plot <- div_env_df %>% 
  filter(scale == "gamma") %>% 
  ggplot(aes(x = year, y = sd_temp_12M, fill = year)) + 
  facet_grid(.~site) +
  geom_point(aes(color = year)) +
  scale_fill_manual(values = color_years, name = "Year", labels = c("Mean", "2016", "2017", "2018")) +
  scale_color_manual(values = color_years, name = "Year", labels = c("Mean", "2016", "2017", "2018")) +
  xlab("Year") +
  ylab(bquote(Log~T[SD]~(ºC))) +
  ggtitle("") +
  # ylim(2, 3.5) +
  scale_x_discrete(label = c("Av", "16", "17", "18")) +
  # geom_jitter(aes(color = year, shape = year), position = position_jitter(width=.1, height=0)) +
  theme_tq() + 
  theme(plot.title = element_text(hjust = 0, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```

### Figure 2. Regional climate and accumulated diversity across the Iberian Pond Network

**Figure 2.** Regional climate context and cumulative γ-diversity across the Iberian Pond Network. (A) Average across years (Av) and annual mean water temperature (TMean) for the six study regions. (B) Annual temperature variability (TSD, standard deviation of daily means). (C) Accumulated regional (γ) diversity across the three-year study period, showing total taxon richness for each trophic group. Regions are ordered from coldest to warmest: MD – Madrid, JC – Jaca, PT – Porto, EV – Évora, TL – Toledo, MR – Murcia. Years: Av – average across 2016–2018; 16 – 2016; 17 – 2017; 18 – 2018. Trophic groups: W – whole community, B – bacteria, P – phytoplankton, Z – zooplankton, M – macroinvertebrates.

```{r Accumulated regional diversity, fig.width=10, fig.height=4, dpi=300, echo=FALSE}

div_temp <- ggarrange(
  ggarrange(meantemp_plot, sdtemp_plot,
            nrow = 2, labels = c("A", "B"),
            font.label = list(size = 10)),
  ggarrange(global_reg_div, labels = "C", font.label = list(size = 10)),
  ncol = 2)

# --------------------------------------------
# Export Figure 2
# --------------------------------------------
ggsave(
  "../figures/Figure_2_Regional_climate_accumulated_diversity.png",
  plot = div_temp,
  dpi = 300, width = 10, height = 4, units = "in"
)

```

## Temperature–diversity relationships across spatial scales
To evaluate how thermal regimes influence biodiversity at nested spatial scales, we model α-, β-, and γ-diversity against both the temporal average of mean temperature and the inter-annual variability in temperature. Figure 3 highlights patterns for TMean, whereas Figure 4 focuses on temperature variability (TSD). Significant quadratic or linear fits reported in the manuscript are reproduced here with the appropriate confidence intervals.

### Regional diversity
```{r}

## Mean temperature
### Average
gamma_mean_temp_mean <- 
  div_env_df %>%
  filter(scale == "gamma", year == "Mean", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = formula) +
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.4, 2.6, 2.8, 3.0)) +
  xlab("") +
  ylab(expression("Temporal average "*gamma*"-diversity")) +
  ggtitle("Regional Scale") +
  theme_tq() + 
  #scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```


```{r}
### 2016
gamma_mean_temp_2016 <- 
  div_env_df %>%
  filter(scale == "gamma", year == "2016", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = formula) +
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  xlab("") +
  ylab("") +
  ggtitle("2016") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2017
gamma_mean_temp_2017 <- 
  div_env_df %>%
  filter(scale == "gamma", year == "2017", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Whole-community"), 
              color = color_group[1], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Bacteria"), 
              color = color_group[2], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Phytoplankton"), 
              color = color_group[3], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Zooplankton"), 
              color = color_group[4], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2017" & group=="Macroinvertebrates"), 
              color = color_group[5], method = "lm", size = 1.25, formula = formula) +

  coord_cartesian(ylim = c(0, max(div_env_df$diversity)*1.05)) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  ggtitle("2017") +
  xlab("") + ylab("") +
  theme_tq() +
  scale_colour_identity()

### 2018
gamma_mean_temp_2018 <- 
  div_env_df %>%
  filter(scale == "gamma", year == "2018", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Whole-community"), 
              color = color_group[1], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Bacteria"), 
              color = color_group[2], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Phytoplankton"), 
              color = color_group[3], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Zooplankton"), 
              color = color_group[4], method = "lm", size = 1.25, formula = formula) +

  geom_point(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale=="gamma" & year=="2018" & group=="Macroinvertebrates"), 
              color = color_group[5], method = "lm", size = 1.25, formula = formula) +

  coord_cartesian(ylim = c(0, max(div_env_df$diversity)*1.05)) +
  ylim(0, 600) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  ggtitle("2018") +
  xlab("") + ylab("") +
  theme_tq() +
  scale_colour_identity()
```

```{r}
## SD temperature
### Mean
gamma_sd_temp_mean <- 
  div_env_df %>%
  filter(scale == "gamma", year == "Mean", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity), color = color_group[1]) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "Mean" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = formula) +
  
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.0, 2.1)) +
  xlab("") +
  ylab(expression("Temporal average "*gamma*"-diversity")) +
  ggtitle("Regional Scale") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2016
gamma_sd_temp_2016 <- 
  div_env_df %>%
  filter(scale == "gamma", year == "2016", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2016" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = formula) +
  
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2016") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2017
gamma_sd_temp_2017 <- 
  div_env_df %>%
  filter(scale == "gamma", year == "2017", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2017" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = formula) +
  
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2017") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2018
gamma_sd_temp_2018 <- 
  div_env_df %>%
  filter(scale == "gamma", year == "2018", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "gamma" & year == "2018" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = y~x) +
  
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2018") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```

### Local diversity
```{r}
## Mean temperature
### Mean
alpha_mean_temp_mean <- 
  div_env_df %>%
  filter(scale == "alpha", year == "Mean", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity), color = color_group[1]) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = y~x) +
  ylim(0, 300) +
  xlim(2.4, 3.02) +
  scale_x_continuous(breaks = c(2.4, 2.6, 2.8, 3.0)) +
  xlab("") +
  ylab(expression("Temporal average "*alpha*"-diversity")) +
  ggtitle("Local Scale") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2016
alpha_mean_temp_2016 <- 
  div_env_df %>%
  filter(scale == "alpha", year == "2016", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Macroinvertebrates"), 
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = formula) + # not significant

  ylim(0, 300) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  xlab("") +
  ylab("") +
  ggtitle("2016") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2017
alpha_mean_temp_2017 <- 
  div_env_df %>%
  filter(scale == "alpha", year == "2017", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Macroinvertebrates"), 
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  ylim(0, 300) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  xlab("") +
  ylab("") +
  ggtitle("2017") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2018
alpha_mean_temp_2018 <- 
  div_env_df %>%
  filter(scale == "alpha", year == "2018", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = y~x) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = formula) +
  
  ylim(0, 300) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  xlab("") +
  ylab("") +
  ggtitle("2018") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```

```{r}
## SD temperature
### Mean
alpha_sd_temp_mean <- 
  div_env_df %>%
  filter(scale == "alpha", year == "Mean", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity), color = color_group[1]) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "Mean" & group == "Macroinvertebrates"),
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = y~x) + 
  
  ylim(0, 300) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.0, 2.1)) +
  xlab("") +
  ylab(expression("Temporal average "*alpha*"-diversity")) +
  ggtitle("Local Scale") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2016
alpha_sd_temp_2016 <- 
  div_env_df %>%
  filter(scale == "alpha", year == "2016", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2016" & group == "Macroinvertebrates"), 
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  ylim(0, 300) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2016") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2017
alpha_sd_temp_2017 <- 
  div_env_df %>%
  filter(scale == "alpha", year == "2017", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Bacteria"),
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Phytoplankton"), 
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2017" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = y~x) +
  
  ylim(0, 300) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2017") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2018
alpha_sd_temp_2018 <- 
  div_env_df %>%
  filter(scale == "alpha", year == "2018", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = y~x) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Zooplankton"), color = color_group[4]) +
  # geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Zooplankton"), 
  #             aes(group = group == "Zooplankton"), color = color_group[4],
  #             method = "lm", size = 1.25, formula = formula) +
  
  geom_point(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "alpha" & year == "2018" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = y~x) +
  
  ylim(0, 300) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2018") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```

### Beta diversity
```{r}
## Mean temperature
### Mean
beta_mean_temp_mean <- 
  div_env_df %>%
  filter(scale == "beta2", year == "Mean", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity), color = color_group[1]) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = y~x) +
  
  ylim(0, 6) +
  xlim(2.4, 3.02) +
  scale_x_continuous(breaks = c(2.4, 2.6, 2.8, 3.0)) +
  xlab("") +
  ylab(expression("Temporal average "*beta*"-diversity")) +
  ggtitle("Turnover") +
  theme_tq() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2016
beta_mean_temp_2016 <- 
  div_env_df %>%
  filter(scale == "beta2", year == "2016", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Macroinvertebrates"), 
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  ylim(0, 6) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  xlab("") +
  ylab("") +
  ggtitle("2016") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2017
beta_mean_temp_2017 <- 
  div_env_df %>%
  filter(scale == "beta2", year == "2017", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Zooplankton"), color = color_group[4]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Zooplankton"), 
              aes(group = group == "Zooplankton"), color = color_group[4],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Macroinvertebrates"), 
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  ylim(0, 6) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  xlab("") +
  ylab("") +
  ggtitle("2017") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2018
beta_mean_temp_2018 <- 
  div_env_df %>%
  filter(scale == "beta2", year == "2018", group == "Whole-community") %>%
  ggplot(aes(x = Tmean_est_mean, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = y~x) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Zooplankton"), color = color_group[4]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Zooplankton"), 
  #             aes(group = group == "Zooplankton"), color = color_group[4],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = y~x) +
  
  ylim(0, 6) +
  xlim(2.33, 3.02) +
  scale_x_continuous(breaks = c(2.5, 3.0)) +
  xlab("") +
  ylab("") +
  ggtitle("2018") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```

```{r}
## SD temperature
### Mean
beta_sd_temp_mean <- 
  div_env_df %>%
  filter(scale == "beta2", year == "Mean", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity), color = color_group[1]) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Phytoplankton"),
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = formula) + 
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Zooplankton"), color = color_group[4]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Zooplankton"), 
  #             aes(group = group == "Zooplankton"), color = color_group[4],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "Mean" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = formula) +
  
  ylim(0, 6) +
  xlim(1.8, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.0, 2.1)) +
  xlab("") +
  ylab(expression("Temporal average "*beta*"-diversity")) +
  ggtitle("Turnover") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2016
beta_sd_temp_2016 <- 
  div_env_df %>%
  filter(scale == "beta2", year == "2016", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Whole-community"), color = color_group[1]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Whole-community"), 
              aes(group = group == "Whole-community"), color = color_group[1],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Bacteria"), color = color_group[2]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Bacteria"), 
              aes(group = group == "Bacteria"), color = color_group[2],
              method = "lm", size = 1.25, formula = y~x) +
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Phytoplankton"), color = color_group[3]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Phytoplankton"),
              aes(group = group == "Phytoplankton"), color = color_group[3],
              method = "lm", size = 1.25, formula = y~x) + 
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Zooplankton"), color = color_group[4]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Zooplankton"), 
  #             aes(group = group == "Zooplankton"), color = color_group[4],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2016" & group == "Macroinvertebrates"), 
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  ylim(0, 6) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2016") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

## Compute p-values for each group
#pvals <- div_env_df %>%
#  filter(scale == "beta2", year == "2017") %>%
#  group_by(group) %>%
#  do({
#    mod <- lm(diversity ~ sd_temp_12M, data = .)
#    tibble(p = summary(mod)$coefficients[2,4])
#  }) %>%
#  mutate(sig = p < 0.05)
#
#dat_2017 <- div_env_df %>%
#  filter(scale == "beta2", year == "2017") %>%
#  left_join(pvals, by = "group")
#
#beta_sd_temp_2017 <- 
#  ggplot(dat_2017, aes(x = sd_temp_12M, y = diversity, color = group)) +
#  geom_point(alpha = 0.8, size = 2) +
#
#  # Only draw regression lines where sig == TRUE
#  geom_smooth(
#    data = subset(dat_2017, sig == TRUE),
#    method = "lm", formula = y ~ x,
#    size = 1.25, se = FALSE
#  ) +
#
#  scale_color_manual(values = color_group, name = NULL) +
#  ylim(0, 6) +
#  xlim(1.80, 2.2) +
#  scale_x_continuous(breaks = c(1.9, 2.1)) +
#  labs(title = "2017", x = "", y = "") +
#  theme_tq() +
#  theme(
#    legend.position = "none",
#    plot.title = element_text(hjust = 0.5, size = 10, face = "bold"),
#    axis.text.y = element_blank()
#  )

### 2017
beta_sd_temp_2017 <- 
  div_env_df %>%
  filter(scale == "beta2", year == "2017", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Zooplankton"), color = color_group[4]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Zooplankton"), 
  #             aes(group = group == "Zooplankton"), color = color_group[4],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Macroinvertebrates"), color = color_group[5]) +
  geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2017" & group == "Macroinvertebrates"), 
              aes(group = group == "Macroinvertebrates"), color = color_group[5],
              method = "lm", size = 1.25, formula = y~x) +
  
  ylim(0, 6) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2017") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

### 2018
beta_sd_temp_2018 <- 
  div_env_df %>%
  filter(scale == "beta2", year == "2018", group == "Whole-community") %>%
  ggplot(aes(x = sd_temp_12M, y = diversity)) +
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Whole-community"), color = color_group[1]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Whole-community"), 
  #             aes(group = group == "Whole-community"), color = color_group[1],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Bacteria"), color = color_group[2]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Bacteria"), 
  #             aes(group = group == "Bacteria"), color = color_group[2],
  #             method = "lm", size = 1.25, formula = y~x) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Phytoplankton"), color = color_group[3]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Phytoplankton"), 
  #             aes(group = group == "Phytoplankton"), color = color_group[3],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Zooplankton"), color = color_group[4]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Zooplankton"), 
  #             aes(group = group == "Zooplankton"), color = color_group[4],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  geom_point(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Macroinvertebrates"), color = color_group[5]) +
  # geom_smooth(data = subset(div_env_df, scale == "beta2" & year == "2018" & group == "Macroinvertebrates"), 
  #             aes(group = group == "Macroinvertebrates"), color = color_group[5],
  #             method = "lm", size = 1.25, formula = formula) + # not significant
  
  ylim(0, 6) +
  xlim(1.80, 2.2) +
  scale_x_continuous(breaks = c(1.9, 2.1)) +
  xlab("") +
  ylab("") +
  ggtitle("2018") +
  theme_tq() + 
  scale_colour_identity() +
  theme(plot.title = element_text(hjust = 0.5, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```

### Figure 3. Relationships between mean temperature (TMean) and multi-trophic diversity across spatial scales

**Figure 3.** Temperature–diversity relationships based on Log₁₀ TMean. (A–C) Temporal averages for (A) local (α), (B) turnover (β), and (C) regional (γ) diversity. (D–F) Annual dynamics of the same three components for 2016–2018. Solid lines with shaded 95 % confidence intervals depict significant quadratic or linear regressions; colours encode trophic groups. Statistical summaries for all models appear in Tables S1–S2. Across trophic levels, diversity generally followed unimodal responses to mean temperature, particularly for consumer groups (zooplankton and macroinvertebrates) and at the regional scale, highlighting scale-dependent thermal constraints on biodiversity.

```{r include=FALSE, fig.asp=0.8, fig.width=14, dpi=300}
gamma_tmean <- ggarrange(gamma_mean_temp_mean + rremove("ylab") + rremove("xlab"),
                         common.legend = T, legend = "bottom")
gamma_tmean <- annotate_figure(gamma_tmean, 
                               left = text_grob(expression("Temporal average  "*gamma*"-diversity"), rot = 90, vjust = 1, size = 10),
                               bottom = text_grob(bquote(Log[10]~T[Mean]~(ºC)), size = 10))

alpha_tmean <- ggarrange(alpha_mean_temp_mean + rremove("ylab") + rremove("xlab"),
                         common.legend = T, legend = "bottom")
alpha_tmean <- annotate_figure(alpha_tmean, 
                               left = text_grob(expression("Temporal average  "*alpha*"-diversity"), rot = 90, vjust = 1, size = 10),
                               bottom = text_grob(bquote(Log[10]~T[Mean]~(ºC)), size = 10))

beta_tmean <- ggarrange(beta_mean_temp_mean + rremove("ylab") + rremove("xlab"),
                         common.legend = T, legend = "bottom")
beta_tmean <- annotate_figure(beta_tmean, 
                               left = text_grob(expression("Temporal average  "*beta*"-diversity"), rot = 90, vjust = 1, size = 10),
                               bottom = text_grob(bquote(Log[10]~T[Mean]~(ºC)), size = 10))

gamma_years_tmean <- ggarrange(gamma_mean_temp_2016 + rremove("ylab") + rremove("xlab"), 
                         gamma_mean_temp_2017 + rremove("ylab") + rremove("xlab"), 
                         gamma_mean_temp_2018 + rremove("ylab") + rremove("xlab"), 
                         nrow = 1, ncol = 3, widths = c(1.3, 1, 1),
                         common.legend = T, legend = "bottom")
gamma_years_tmean <- annotate_figure(gamma_years_tmean, 
                               left = text_grob(expression("Annual  "*gamma*"-diversity"), rot = 90, vjust = 1, size = 10),
                               bottom = text_grob(bquote(Log[10]~T[Mean]~(ºC)), size = 10))

alpha_years_tmean <- ggarrange(alpha_mean_temp_2016 + rremove("ylab") + rremove("xlab"), 
                         alpha_mean_temp_2017 + rremove("ylab") + rremove("xlab"), 
                         alpha_mean_temp_2018 + rremove("ylab") + rremove("xlab"), 
                         nrow = 1, ncol = 3, widths = c(1.3, 1, 1),
                         common.legend = T, legend = "bottom")
alpha_years_tmean <- annotate_figure(alpha_years_tmean, 
                               left = text_grob(expression("Annual  "*alpha*"-diversity"), rot = 90, vjust = 1, size = 10),
                               bottom = text_grob(bquote(Log[10]~T[Mean]~(ºC)), size = 10))

beta_years_tmean <- ggarrange(beta_mean_temp_2016 + rremove("ylab") + rremove("xlab"), 
                        beta_mean_temp_2017 + rremove("ylab") + rremove("xlab"), 
                        beta_mean_temp_2018 + rremove("ylab") + rremove("xlab"), 
                        nrow = 1, ncol = 3, widths = c(1.1, 1, 1),
                        common.legend = T, legend = "bottom")
beta_years_tmean <- annotate_figure(beta_years_tmean,
                              left = text_grob(expression("Annual  "*beta*"-diversity"), rot = 90, vjust = 1, size = 10),
                              bottom = text_grob(bquote(Log[10]~T[Mean]~(ºC)), size = 10))

div_mean_temp_plot <- ggarrange(alpha_tmean, beta_tmean, gamma_tmean, 
                                alpha_years_tmean, beta_years_tmean, gamma_years_tmean, 
                                nrow = 2, ncol = 3,
                                common.legend = T, legend = "bottom", labels = "AUTO")
div_mean_temp_plot

```


```{r include=FALSE, fig.asp=0.8, fig.width=14, dpi=300}
# --------------------------------------------
# Export Figure 3
# --------------------------------------------
ggsave(
  "../figures/Figure_3_div_mean_temp_plot.png",
  plot = div_mean_temp_plot,
  dpi = 300, width = 14, height = 11.2, units = "in"
)

```

```{r Mean annual temperature temporal avg, fig.width=10, fig.height=4, dpi=300, echo=FALSE}
# div_avg_mean_temp_plot <- ggarrange(alpha_tmean, gamma_tmean, beta_tmean, 
#                                     nrow = 1, ncol = 3,
#                                     common.legend = T, legend = "bottom", labels = "AUTO")
# div_avg_mean_temp_plot
```

```{r Mean annual temperature years, fig.width=10, fig.height=4, dpi=300, echo=FALSE}
# div_year_mean_temp_plot <- ggarrange(alpha_years_tmean, gamma_years_tmean, beta_years_tmean, 
#                                      nrow = 1, ncol = 3,
#                                      common.legend = T, legend = "bottom", labels = "AUTO")
# div_year_mean_temp_plot
```

### Figure 4. Relationships between temperature variability (TSD) and multi-trophic diversity across spatial scales

**Figure 4.** Effects of Log₁₀ temperature variability (TSD) on α-, β-, and γ-diversity. (A–C) Temporal averages for (A) local, (B) turnover, and (C) regional diversity. (D–F) Annual trajectories for 2016–2018. Significant quadratic regressions are plotted with shaded 95 % confidence intervals, with colours denoting trophic groups. Full statistical details are reported in Tables S1–S2. Diversity often showed U-shaped responses to thermal variability, strongest for consumer groups and at the regional scale, underscoring the role of moderate thermal regimes in sustaining biodiversity across the network.

```{r include=FALSE, fig.asp=0.8, fig.width=14, dpi=300}

gamma_tsd <- ggarrange(gamma_sd_temp_mean + rremove("ylab") + rremove("xlab"),
                       common.legend = T, legend = "bottom")
gamma_tsd <- annotate_figure(gamma_tsd, 
                             left = text_grob(expression("Temporal average  "*gamma*"-diversity"), rot = 90, vjust = 1, size = 16),
                               bottom = text_grob(bquote(Log[10]~T[SD]~(ºC)), size = 14))

alpha_tsd <- ggarrange(alpha_sd_temp_mean + rremove("ylab") + rremove("xlab"),
                       common.legend = T, legend = "bottom")
alpha_tsd <- annotate_figure(alpha_tsd, 
                             left = text_grob(expression("Temporal average  "*alpha*"-diversity"), rot = 90, vjust = 1, size = 16),
                               bottom = text_grob(bquote(Log[10]~T[SD]~(ºC)), size = 14))

beta_tsd <- ggarrange(beta_sd_temp_mean + rremove("ylab") + rremove("xlab"),
                      common.legend = T, legend = "bottom")
beta_tsd <- annotate_figure(beta_tsd, 
                            left = text_grob(expression("Temporal average  "*beta*"-diversity"), rot = 90, vjust = 1, size = 16),
                               bottom = text_grob(bquote(Log[10]~T[SD]~(ºC)), size = 14))

gamma_years_tsd <- ggarrange(gamma_sd_temp_2016 + rremove("ylab") + rremove("xlab"), 
                         gamma_sd_temp_2017 + rremove("ylab") + rremove("xlab"), 
                         gamma_sd_temp_2018 + rremove("ylab") + rremove("xlab"), 
                         nrow = 1, ncol = 3, widths = c(1.3, 1, 1),
                         common.legend = T, legend = "bottom")
gamma_years_tsd <- annotate_figure(gamma_years_tsd, 
                               left = text_grob(expression("Annual  "*gamma*"-diversity"), rot = 90, vjust = 1, size = 16),
                               bottom = text_grob(bquote(Log[10]~T[SD]~(ºC)), size = 14))

alpha_years_tsd <- ggarrange(alpha_sd_temp_2016 + rremove("ylab") + rremove("xlab"), 
                         alpha_sd_temp_2017 + rremove("ylab") + rremove("xlab"), 
                         alpha_sd_temp_2018 + rremove("ylab") + rremove("xlab"), 
                         nrow = 1, ncol = 3, widths = c(1.3, 1, 1),
                         common.legend = T, legend = "bottom")
alpha_years_tsd <- annotate_figure(alpha_years_tsd, 
                               left = text_grob(expression("Annual  "*alpha*"-diversity"), rot = 90, vjust = 1, size = 16),
                               bottom = text_grob(bquote(Log[10]~T[SD]~(ºC)), size = 14))

beta_years_tsd <- ggarrange(beta_sd_temp_2016 + rremove("ylab") + rremove("xlab"), 
                        beta_sd_temp_2017 + rremove("ylab") + rremove("xlab"), 
                        beta_sd_temp_2018 + rremove("ylab") + rremove("xlab"), 
                        nrow = 1, ncol = 3, widths = c(1.1, 1, 1),
                        common.legend = T, legend = "bottom")
beta_years_tsd <- annotate_figure(beta_years_tsd,
                              left = text_grob(expression("Annual  "*beta*"-diversity"), rot = 90, vjust = 1, size = 16),
                              bottom = text_grob(bquote(Log[10]~T[SD]~(ºC)), size = 14))


div_sd_temp_plot <- ggarrange(alpha_tsd, beta_tsd, gamma_tsd,
                              alpha_years_tsd, beta_years_tsd, gamma_years_tsd, 
                              nrow = 2, ncol = 3,
                              common.legend = T, legend = "bottom", labels = "AUTO")
div_sd_temp_plot

# --------------------------------------------
# Export Figure 4
# --------------------------------------------
ggsave(
  "../figures/Figure_4_div_sd_temp_plot.png",
  plot = div_sd_temp_plot,
  dpi = 300, width = 14, height = 11.2, units = "in"
)

```

```{r Annual temperature variability temporal avg, fig.width=10, fig.height=4, dpi=300, echo=FALSE}
# div_avg_sd_temp_plot <- ggarrange(alpha_tsd, gamma_tsd, beta_tsd, 
#                                   nrow = 1, ncol = 3,
#                                   common.legend = T, legend = "bottom", labels = "AUTO")
# div_avg_sd_temp_plot
```

```{r Annual temperature variability, fig.width=10, fig.height=4, dpi=300, echo=FALSE}
# div_year_sd_temp_plot <- ggarrange(alpha_yearsa_tsd, gamma_yearsa_tsd, beta_yearsa_tsd, 
#                                    nrow = 1, ncol = 3,
#                                    common.legend = T, legend = "bottom", labels = "AUTO")
# div_year_sd_temp_plot
```

# Supplementary analyses
Supplementary sections document additional diagnostics referenced in the main text, including taxonomic resolution summaries for each trophic group and expanded depictions of regional diversity stratified by year.

## Taxonomic Resolution

Estimate percentages of identification level
```{r}
target <- c("domain", "kingdom", "phylum", "class", "order", "family", "genus", "species") # to order rows

# Bacteria
id.bact <- hybrid_geo_fit_tax %>% 
  filter(group == "bacteria") %>% # filter taxonomic group
  group_by(id_level) %>% # group by id level
  summarise(cnt = n()) %>% # count nr by id level
  mutate(perc = round((cnt / sum(cnt) * 100), 2)) %>% # calculate percentages by id level
  rbind(data.frame(id_level = "domain", cnt = 0, perc = 0)) %>% # add missing id level
  slice(match(target, id_level)) # order rows

# Phytoplankton
id.phyto <- hybrid_geo_fit_tax %>% 
  filter(group == "phytoplankton") %>%
  group_by(id_level) %>%
  summarise(cnt = n()) %>%
  mutate(perc = round((cnt / sum(cnt) * 100), 2)) %>%
  #rbind(data.frame(id_level = "domain", cnt = 0, perc = 0)) %>%
  slice(match(target, id_level))

# Zooplankton
id.zoo <- hybrid_geo_fit_tax %>% 
  filter(group == "zooplankton") %>%
  group_by(id_level) %>%
  summarise(cnt = n()) %>%
  mutate(perc = round((cnt / sum(cnt) * 100), 2)) %>%
  rbind(data.frame(id_level = c("domain", "kingdom", "phylum"), cnt = c(0, 0, 0), perc = c(0, 0, 0))) %>%
  slice(match(target, id_level))

# Macroinvertebrates
id.macro <- hybrid_geo_fit_tax %>% 
  filter(group == "macroinvertebrates") %>%
  group_by(id_level) %>%
  summarise(cnt = n()) %>%
  mutate(perc = round((cnt / sum(cnt) * 100), 2)) %>%
  rbind(data.frame(id_level = "domain", cnt = 0, perc = 0)) %>%
  slice(match(target, id_level))

```

Data frame with all percentages
```{r}
id.all <- data.frame(
  Trophic_group = rep(c("Bacteria", "Phytoplankton", "Zooplankton", "Macroinvertebrates"), each = 8),
  Taxonomic_rank = rep(c("Domain", "Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species"), 4),
  Percentage = c(id.bact$perc, id.phyto$perc, id.zoo$perc, id.macro$perc)
  )
```

### Figure S2. Taxonomic resolution obtained for each trophic group
Figure S2. Taxonomic resolution obtained for each trophic group: Bacteria, Phytoplankton, Zooplankton and Macroinvertebrates. Bacteria data was obtained with eDNA only. For phytoplankton, zooplankton and macroinvertebrates, we paired eDNA metabarcoding (i.e., only occurrences) and morphological (i.e., occurrences and abundances) data following a series of taxonomic assignment and geographic filters (Pereira et al. 2021a), maximising the taxonomic resolution of the final dataset. See Pereira et al. (2021a) for differences between eDNA-based and morphological-based approaches.

```{r Taxonomic resolution, fig.width=8, dpi=300, echo=FALSE}
# Set blank theme
blank_theme <- theme_minimal()+
  theme(
  axis.title.x = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.ticks = element_blank()
  )

# Set colors
mycol <- viridis(8, option = "D", direction = -1)

# Plot cumulative bar plots with identification level
p.id.all <- id.all %>%
  ggplot(aes(x = factor(Trophic_group,
                        levels = c("Bacteria", "Phytoplankton", "Zooplankton", "Macroinvertebrates"),
                        labels = c("Bacteria", "Phytoplankton", "Zooplankton", "Macroinvertebrates")),
             y = Percentage,
             fill = factor(Taxonomic_rank, levels = c("Domain", "Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species")))) + 
  geom_bar(position = "stack", stat = "identity") +
  geom_text(aes(
    label = ifelse(Percentage > 3, paste0(Percentage, "%"), ""),
    color = "white"),
    position = position_stack(vjust = 0.5),
    size = 2,
    show.legend = FALSE) +
  scale_color_identity() +
  scale_fill_manual(values = mycol) +
  xlab("") +
  ylab("Taxonomic Resolution") +
  blank_theme +
  theme(axis.text = element_text(size = 10),
          axis.text.y = element_blank(),
          axis.title = element_text(size = 10),
          legend.text = element_text(size = 8),
          legend.position = "bottom", 
          legend.direction = "horizontal", 
          legend.title = element_blank())

p.id.all

# --------------------------------------------
# Export Figure S2
# --------------------------------------------
ggsave(
  "../figures/Figure_S2_p.id.all.png",
  plot = p.id.all,
  dpi = 300, width = 8, units = "in"
)

```

## Regional diversity across regions and years

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Mean regional diversity
reg_mean <- div_env_df %>%
  filter(scale == "gamma", year == "Mean") %>% 
  ggplot(aes(x = group, y = diversity, fill = group)) + 
  facet_grid(. ~ site) +
  geom_bar(stat = "identity", position = "dodge", width = 0.8) +
  
  scale_fill_manual(values = color_group) +
  
  scale_x_discrete(labels = c(
  "Whole-community" = "W",
  "Bacteria"        = "B",
  "Phytoplankton"   = "P",
  "Zooplankton"     = "Z",
  "Macroinvertebrates" = "M"
))+
  
  labs(
    x = "Trophic Group",
    y = expression("Average "*gamma*"-diversity (Temporal)"),
    title = "Temporal averaging regional diversity"
  ) +
  
  #ylim(0, 1100) +
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  theme_tq() + 
  theme(
    plot.title = element_text(hjust = 0, size = 10, face = "bold"), 
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 10),
    legend.position = "none",
    panel.spacing = unit(0.5, "lines"),
    panel.grid.major = element_blank(),
    strip.background = element_rect(fill = "white", size = 0.5),
    strip.text.x = element_text(size = 10, color = "black")
  )

# 2016 Annual regional diversity
reg_2016 <- div_env_df %>%
  filter(scale == "gamma", year == "2016") %>%  
  ggplot(aes(x = group, y = diversity, fill = group)) + 
  facet_grid(.~site) +
  geom_bar(stat = "identity", position = "dodge", width = 0.8, outlier.shape = NA) +
  scale_fill_manual(values = color_group, name = "", labels = c("W: Whole-community", "B: Bacteria", "P: Phytoplankton", "Z: Zooplankton", "M: Macroinvertebrates")) +
  scale_x_discrete(label = c("W", "B", "P", "Z", "M")) +
  labs(x = "Trophic Group", y = expression("Annual "*gamma*"-diversity"), title = "2016 Annual regional diversity") +
  #ylim(0, 1100) +
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  theme_tq() + 
  theme(plot.title = element_text(hjust = 0, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

# 2017 Annual regional diversity
reg_2017 <- div_env_df %>%
  filter(scale == "gamma", year == "2017") %>% 
  ggplot(aes(x = group, y = diversity, fill = group)) + 
  facet_grid(.~site) +
  geom_bar(stat = "identity", position = "dodge", width = 0.8, outlier.shape = NA) +
  scale_fill_manual(values = color_group, name = "", labels = c("W: Whole-community", "B: Bacteria", "P: Phytoplankton", "Z: Zooplankton", "M: Macroinvertebrates")) +
  scale_x_discrete(label = c("W", "B", "P", "Z", "M")) +
  labs(x = "Trophic Group", y = expression("Annual "*gamma*"-diversity"), title = "2017 Annual regional diversity") +
  #ylim(0, 1100) +
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  theme_tq() + 
  theme(plot.title = element_text(hjust = 0, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )

# 2018 Annual regional diversity
reg_2018 <- div_env_df %>%
  filter(scale == "gamma", year == "2018") %>% 
  ggplot(aes(x = group, y = diversity, fill = group)) + 
  facet_grid(.~site) +
  geom_bar(stat = "identity", position = "dodge", width = 0.8, outlier.shape = NA) +
  scale_fill_manual(values = color_group, name = "", labels = c("W: Whole-community", "B: Bacteria", "P: Phytoplankton", "Z: Zooplankton", "M: Macroinvertebrates")) +
  scale_x_discrete(label = c("W", "B", "P", "Z", "M")) +
  labs(x = "Trophic group", y = expression("Annual "*gamma*"-diversity"), title = "2018 Annual regional diversity") +
  #ylim(0, 1100) +
  coord_cartesian(ylim = c(0, max(div_env_df$diversity) * 1.05)) +
  theme_tq() + 
  theme(plot.title = element_text(hjust = 0, size = 10, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5, face = "italic"),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(size = 10),
        panel.spacing = unit(0.5, "lines"),
        panel.grid.major = element_blank(), 
        #panel.grid.minor = element_blank(),
        strip.background = element_rect(fill = "white", size = 0.5, linetype = "solid"),
        strip.text.x = element_text(size = 10, color = "black")
        )
```

### Figure S3. Regional diversity across regions and years

Figure S3. Regional diversity across regions and years. A) Temporal averaging regional diversity, average of the number of taxa of the study period. Annual regional diversity of: B) 2016, C) 2017, and D) 2018. Regions are represented from coldest to warmest: MD – Madrid, JC – Jaca, PT – Porto, EV – Evora, TL – Toledo, MR – Murcia. Colours indicate different trophic groups: W – Whole-community, B – Bacteria, P – Phytoplankton, Z – Zooplankton, M – Macroinvertebrates.

```{r Regional diversity across regions and years, fig.width=10, fig.height=8, dpi=300, echo=FALSE}
reg_div <- ggarrange(reg_mean, reg_2016, reg_2017, reg_2018,
                     nrow = 2, ncol = 2,
                     labels = "AUTO", font.label = list(size = 10),
                     common.legend = T, legend = "bottom")
reg_div

# --------------------------------------------
# Export Figure S3
# --------------------------------------------
ggsave(
  "../figures/Figure_S3_reg_div.png",
  plot = reg_div,
  dpi = 300, width = 10, height = 8, units = "in"
)

```

# Reproducibility checks
Documenting the computational environment facilitates independent verification of the analyses.

```{r session-info}
sessionInfo()
```

